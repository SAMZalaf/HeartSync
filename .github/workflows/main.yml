name: Unzip fkDGTlmlf.zip to main

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  unzip-to-main:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main branch
        uses: actions/checkout@v3
        with:
          ref: main
          fetch-depth: 0
          persist-credentials: true
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Ensure unzip is installed
        run: sudo apt-get update && sudo apt-get install -y unzip

      - name: Confirm zip exists
        run: |
          if [ ! -f fkDGTlmlf.zip ]; then
            echo "ERROR: fkDGTlmlf.zip not found in repo root"
            exit 1
          fi
          echo "Found fkDGTlmlf.zip"

      - name: Unzip fkDGTlmlf.zip into extracted/
        run: |
          mkdir -p extracted
          unzip -o fkDGTlmlf.zip -d extracted

      - name: Show extracted files
        run: ls -la extracted

      - name: Commit extracted files
        run: |
          git config user.name "github-actions[bot]"
          git.config user.email "github-actions[bot]@users.noreply.github.com"
          git add extracted || true
          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Add extracted content from fkDGTlmlf.zip"
          fi

      - name: Debug git info before push
        run: |
          git remote -v
          git branch --show-current
          git status --porcelain
          git log -1 --pretty=fuller

      - name: Push to main (verbose)
        run: |
          set -x
          git push origin HEAD:main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
